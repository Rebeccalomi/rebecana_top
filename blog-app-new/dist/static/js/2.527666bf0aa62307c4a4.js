webpackJsonp([2],{"1kS7":function(e,t){t.f=Object.getOwnPropertySymbols},NpIQ:function(e,t){t.f={}.propertyIsEnumerable},R4wc:function(e,t,r){var o=r("kM2E");o(o.S+o.F,"Object",{assign:r("To3L")})},To3L:function(e,t,r){"use strict";var o=r("+E39"),a=r("lktj"),i=r("1kS7"),s=r("NpIQ"),l=r("sB3e"),n=r("MU5D"),c=Object.assign;e.exports=!c||r("S82l")(function(){var e={},t={},r=Symbol(),o="abcdefghijklmnopqrst";return e[r]=7,o.split("").forEach(function(e){t[e]=e}),7!=c({},e)[r]||Object.keys(c({},t)).join("")!=o})?function(e,t){for(var r=l(e),c=arguments.length,u=1,m=i.f,d=s.f;c>u;)for(var p,g=n(arguments[u++]),f=m?a(g).concat(m(g)):a(g),h=f.length,v=0;h>v;)p=f[v++],o&&!d.call(g,p)||(r[p]=g[p]);return r}:c},V3tA:function(e,t,r){r("R4wc"),e.exports=r("FeBl").Object.assign},ZbZn:function(e,t){},ndJR:function(e,t){},tgdm:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("woOf"),a=r.n(o),i=r("33ZO"),s=r("xVlr"),l=r("viA7"),n=r("s8Ph"),c=r("iNxE"),u=(r("uzBN"),{name:"BlogWrite",mounted:function(){this.$route.params.id&&this.getArticle(this.$route.params.id),this.getCategorysAndTags(),this.editorToolBarToFixedWrapper=this.$_.throttle(this.editorToolBarToFixed,200),window.addEventListener("scroll",this.editorToolBarToFixedWrapper,!1)},beforeDestroy:function(){window.removeEventListener("scroll",this.editorToolBarToFixedWrapper,!1)},data:function(){return{publishVisible:!1,categorys:[],tags:[],articleForm:{id:"",title:"",summary:"",category:"",tags:[],weight:"",titleimg:"",editor:{value:"",ref:"",default_open:"edit",toolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,imagelink:!0,code:!0,fullscreen:!0,readmodel:!0,help:!0,undo:!0,redo:!0,trash:!0,navigation:!0,preview:!0}}},rules:{summary:[{required:!0,message:"请输入摘要",trigger:"blur"},{max:80,message:"不能大于80个字符",trigger:"blur"}],category:[{required:!0,message:"请选择文章分类",trigger:"change"}],tags:[{type:"array",required:!0,message:"请选择标签",trigger:"change"}],weight:[{required:!0,message:"请选择是否置顶",trigger:"change"}]},imageUrl:"",postData:{token:""},EncodedEntryURI:""}},computed:{title:function(){return"rebecana_world - 写文章"}},methods:{uploadSuccess:function(e){this.articleForm.titleimg="http://img.rebecana.top/"+e.key,this.EncodedEntryURI=e.key},getArticle:function(e){var t=this,r=this;Object(l.i)(e).then(function(e){a()(r.articleForm,e.data),r.articleForm.editor.value=e.data.body.content;var o=t.articleForm.tags.map(function(e){return e.id});t.articleForm.tags=o,t.articleForm.weight="1"}).catch(function(e){"error"!==e&&r.$message({type:"error",message:"文章加载失败",showClose:!0})})},publishShow:function(){this.articleForm.title?this.articleForm.title.length>30?this.$message({message:"标题不能大于30个字符",type:"warning",showClose:!0}):this.articleForm.editor.ref.d_render?this.publishVisible=!0:this.$message({message:"内容不能为空哦",type:"warning",showClose:!0}):this.$message({message:"标题不能为空哦",type:"warning",showClose:!0})},publish:function(e){var t=this,r=this;this.$refs[e].validate(function(e){if(!e)return!1;var o=t.articleForm.tags.map(function(e){return{id:e}}),a={id:t.articleForm.id,title:t.articleForm.title,summary:t.articleForm.summary,category:t.articleForm.category,tags:o,body:{content:t.articleForm.editor.value,contentHtml:t.articleForm.editor.ref.d_render},weight:t.articleForm.weight};t.publishVisible=!1;var i=t.$loading({lock:!0,text:"发布中，请稍后..."});Object(l.g)(a,t.$store.state.token).then(function(e){e.success?(i.close(),r.$message({message:"发布成功啦",type:"success",showClose:!0}),r.$router.push({path:"/view/"+e.data.id})):r.$message({message:error,type:"发布文章失败:"+e.msg,showClose:!0})}).catch(function(e){i.close(),"error"!==e&&r.$message({message:e,type:"error",showClose:!0})})})},cancel:function(){var e=this;this.$confirm("文章将不会保存, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/")})},getCategorysAndTags:function(){var e=this;Object(n.a)().then(function(t){t.success?e.categorys=t.data:e.$message({type:"error",message:"文章分类加载失败",showClose:!0})}).catch(function(t){"error"!==t&&e.$message({type:"error",message:"文章分类加载失败",showClose:!0})}),Object(c.a)().then(function(t){t.success?e.tags=t.data:e.$message({type:"error",message:"标签加载失败",showClose:!0})}).catch(function(t){"error"!==t&&e.$message({type:"error",message:"标签加载失败",showClose:!0})})},editorToolBarToFixed:function(){var e=document.querySelector(".v-note-op");(document.documentElement.scrollTop||document.body.scrollTop)>=160?(document.getElementById("placeholder").style.display="block",e.classList.add("me-write-toolbar-fixed")):(document.getElementById("placeholder").style.display="none",e.classList.remove("me-write-toolbar-fixed"))}},components:{"base-header":i.a,"markdown-editor":s.a},beforeRouteEnter:function(e,t,r){window.document.body.style.backgroundColor="#fff",r()},beforeRouteLeave:function(e,t,r){window.document.body.style.backgroundColor="#f5f5f5",r()}}),m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"title",rawName:"v-title"}],attrs:{id:"write","data-title":e.title}},[r("el-container",[r("base-header",{attrs:{simple:!0}},[r("el-col",{attrs:{span:4,offset:2}},[r("div",{staticClass:"me-write-info"},[e._v("写文章")])]),e._v(" "),r("el-col",{attrs:{span:4,offset:2}},[r("div",{staticClass:"me-write-btn"},[r("el-button",{attrs:{round:""},on:{click:e.publishShow}},[e._v("发布")]),e._v(" "),r("el-button",{attrs:{round:""},on:{click:e.cancel}},[e._v("取消")])],1)])],1),e._v(" "),r("el-container",{staticClass:"me-area me-write-box"},[r("el-main",{staticClass:"me-write-main"},[r("div",{staticClass:"me-write-title"},[r("el-input",{staticClass:"me-write-input",attrs:{resize:"none",type:"textarea",autosize:"",placeholder:"请输入标题"},model:{value:e.articleForm.title,callback:function(t){e.$set(e.articleForm,"title",t)},expression:"articleForm.title"}})],1),e._v(" "),r("div",{staticStyle:{visibility:"hidden",height:"89px",display:"none"},attrs:{id:"placeholder"}}),e._v(" "),r("markdown-editor",{staticClass:"me-write-editor",attrs:{editor:e.articleForm.editor}})],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"摘要 分类 标签",visible:e.publishVisible,"close-on-click-modal":!1,"custom-class":"me-dialog"},on:{"update:visible":function(t){e.publishVisible=t}}},[r("el-form",{ref:"articleForm",attrs:{model:e.articleForm,rules:e.rules}},[r("el-form-item",{attrs:{prop:"summary"}},[r("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入摘要"},model:{value:e.articleForm.summary,callback:function(t){e.$set(e.articleForm,"summary",t)},expression:"articleForm.summary"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"文章分类",prop:"category"}},[r("el-select",{attrs:{"value-key":"id",placeholder:"请选择文章分类"},model:{value:e.articleForm.category,callback:function(t){e.$set(e.articleForm,"category",t)},expression:"articleForm.category"}},e._l(e.categorys,function(e){return r("el-option",{key:e.id,attrs:{label:e.categoryName,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"文章标签",prop:"tags"}},[r("el-checkbox-group",{model:{value:e.articleForm.tags,callback:function(t){e.$set(e.articleForm,"tags",t)},expression:"articleForm.tags"}},e._l(e.tags,function(t){return r("el-checkbox",{key:t.id,attrs:{label:t.id,name:"tags"}},[e._v(e._s(t.tagName))])}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"是否置顶",prop:"weight"}},[r("el-select",{attrs:{placeholder:"是否置顶"},model:{value:e.articleForm.weight,callback:function(t){e.$set(e.articleForm,"weight",t)},expression:"articleForm.weight"}},[r("el-option",{attrs:{label:"是",value:"1"}}),e._v(" "),r("el-option",{attrs:{label:"否",value:"0"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"导航图片",prop:"titleimg"}},[r("el-upload",{attrs:{action:"http(s)://upload-z2.qiniup.com","on-success":e.uploadSuccess,"on-preview":e.uptoken,limit:1,"list-type":"picture",data:e.postData,accept:".png, .jpg"}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件")])],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.publishVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.publish("articleForm")}}},[e._v("发布")])],1)],1)],1)],1)},staticRenderFns:[]};var d=r("VU/8")(u,m,!1,function(e){r("ndJR")},null,null);t.default=d.exports},uzBN:function(e,t,r){"use strict";t.a=function(e){return Object(o.a)({headers:{"Content-Type":"multipart/form-data"},url:"/upload",method:"post",data:e})};var o=r("OOvn")},woOf:function(e,t,r){e.exports={default:r("V3tA"),__esModule:!0}},xVlr:function(e,t,r){"use strict";var o=r("OS1Z"),a=(r("pw1w"),r("uzBN")),i={name:"MarkdownEditor",props:{editor:Object},data:function(){return{}},mounted:function(){this.$set(this.editor,"ref",this.$refs.md)},methods:{imgAdd:function(e,t){var r=this,o=new FormData;o.append("image",t),Object(a.a)(o).then(function(t){t.success?r.$refs.md.$img2Url(e,t.data):r.$message({message:t.msg,type:"error",showClose:!0})}).catch(function(e){r.$message({message:e,type:"error",showClose:!0})})}},components:{mavonEditor:o.mavonEditor}},s={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("mavon-editor",e._b({ref:"md",staticClass:"me-editor",on:{imgAdd:e.imgAdd},model:{value:e.editor.value,callback:function(t){e.$set(e.editor,"value",t)},expression:"editor.value"}},"mavon-editor",e.editor,!1))},staticRenderFns:[]};var l=r("VU/8")(i,s,!1,function(e){r("ZbZn")},"data-v-638957cb",null);t.a=l.exports}});